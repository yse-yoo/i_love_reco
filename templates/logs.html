<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°å±¥æ­´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const overlay = document.getElementById("dateOverlay");
      const input = document.getElementById("dateInput");

      overlay.addEventListener("click", () => {
        input.showPicker && input.showPicker(); // æ–°ã—ã„ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒãƒ¼ãƒˆ
        input.focus(); // å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚åå¿œã™ã‚‹ã‚ˆã†ã«
      });
    });
  </script>
</head>

<body class="bg-slate-900 text-slate-100 font-sans dark:bg-white dark:text-gray-900">

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header
    class="bg-slate-800 text-white py-4 px-6 flex justify-between items-center dark:bg-gray-100 dark:text-gray-900 border-b border-slate-700 dark:border-gray-300">
    <h1 class="text-2xl font-bold">
      <a href="{{ url_for('index') }}" class="flex items-center">
        <img src="{{ url_for('static', filename='images/icon/logomoji_dark.png') }}" class="h-10 block dark:hidden"
          alt="ãƒ›ãƒ¼ãƒ ">
        <img src="{{ url_for('static', filename='images/icon/logomoji_light.png') }}" class="h-10 hidden dark:block"
          alt="ãƒ›ãƒ¼ãƒ ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰">
      </a>
    </h1>
    <button id="menuToggle" class="text-3xl focus:outline-none">â˜°</button>
  </header>

  <!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div id="mobileMenu" class="fixed top-0 right-0 w-64 h-full bg-slate-900 text-white dark:bg-white dark:text-gray-900
         p-6 flex flex-col justify-between z-50 transform translate-x-full transition-transform duration-300 shadow-2xl
         border-l border-slate-700 dark:border-gray-300">

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸Šéƒ¨ -->
    <div>
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
        <button id="closeMenu" class="text-2xl hover:text-rose-500">âœ•</button>
      </div>

      <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªãƒ³ã‚¯ç¾¤ -->
      <nav class="flex flex-col space-y-2 text-base">
        <!-- ãƒ›ãƒ¼ãƒ  -->
        <a href="{{ url_for('index') }}"
          class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-800 dark:hover:bg-gray-100 hover:shadow-md transition text-base">
          <img src="{{ url_for('static', filename='images/icon/Home_NG.png') }}" alt="ãƒ›ãƒ¼ãƒ ï¼ˆãƒ©ã‚¤ãƒˆï¼‰"
            class="w-6 h-6 block dark:hidden" />
          <img src="{{ url_for('static', filename='images/icon/Home_LG.png') }}" alt="ãƒ›ãƒ¼ãƒ ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰"
            class="w-6 h-6 hidden dark:block" />
          ãƒ›ãƒ¼ãƒ 
        </a>

        <!-- MBTI -->
        <a href="/mbti"
          class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-800 dark:hover:bg-gray-100 hover:shadow-md transition text-base">
          <img src="{{ url_for('static', filename='images/icon/Mbti_NG.png') }}" alt="MBTIï¼ˆãƒ©ã‚¤ãƒˆï¼‰"
            class="w-6 h-6 block dark:hidden" />
          <img src="{{ url_for('static', filename='images/icon/Mbti_LG.png') }}" alt="MBTIï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰"
            class="w-6 h-6 hidden dark:block" />
          MBTI
        </a>

        <!-- å±¥æ­´ -->
        <a href="/logs"
          class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-800 dark:hover:bg-gray-100 hover:shadow-md transition text-base">
          <img src="{{ url_for('static', filename='images/icon/Log_NG.png') }}" alt="å±¥æ­´ï¼ˆãƒ©ã‚¤ãƒˆï¼‰"
            class="w-6 h-6 block dark:hidden" />
          <img src="{{ url_for('static', filename='images/icon/Log_LG.png') }}" alt="å±¥æ­´ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰"
            class="w-6 h-6 hidden dark:block" />
          å±¥æ­´
        </a>

        <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
        <a href="javascript:void(0);" id="toggleDarkMobile"
          class="flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-slate-800 dark:hover:bg-gray-100 hover:shadow-md transition text-base">
          <img src="{{ url_for('static', filename='images/icon/Mode_NG.png') }}" alt="ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆãƒ©ã‚¤ãƒˆï¼‰"
            class="w-6 h-6 block dark:hidden" />
          <img src="{{ url_for('static', filename='images/icon/Mode_LG2.png') }}" alt="ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰"
            class="w-6 h-6 hidden dark:block" />
          ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
        </a>
      </nav>
    </div>


    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ï¼šä¸‹éƒ¨å›ºå®š -->
    <a href="{{ url_for('profile') }}"
      class="flex items-center gap-3 px-4 py-2 mt-2 rounded-lg transition duration-300
          hover:bg-slate-800 dark:hover:bg-gray-100 hover:shadow-md hover:ring-1 hover:ring-slate-600 dark:hover:ring-gray-300">

      {% if mbti_type %}
      <img src="{{ url_for('static', filename='images/' + mbti_type + '.png') }}" alt="{{ mbti_type }}"
        class="w-12 h-12 rounded-full border-2 border-white dark:border-gray-800 shadow-sm mb-2" />
      {% else %}
      <div
        class="w-12 h-12 flex items-center justify-center bg-white text-blue-600 rounded-full font-bold text-lg shadow">
        ğŸ§‘â€ğŸ’¼
      </div>
      {% endif %}

      <div class="flex flex-col">
        <span class="text-sm font-semibold truncate">{{ current_user.username }} ã•ã‚“</span>
        <span class="text-xs text-slate-400 dark:text-gray-600">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span>
      </div>
    </a>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ -->
  <main class="w-full max-w-3xl mx-auto p-6 mt-10 bg-slate-800 dark:bg-gray-200 rounded-2xl shadow-xl space-y-6">
    <h2 class="text-3xl font-bold text-center mb-6 text-white dark:text-gray-900">
      {{ current_user.username }} ã•ã‚“ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´
    </h2>

    <!-- ğŸ” æ—¥ä»˜æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form method="GET" action="{{ url_for('show_logs') }}"
      class="bg-slate-700 dark:bg-white p-6 rounded-xl shadow-lg w-full max-w-4xl mx-auto flex justify-center">

      <div class="flex flex-row items-center gap-4 w-full justify-center">

        <!-- æ¨ªé•·æ—¥ä»˜å…¥åŠ› -->
        <div class="relative flex-1 max-w-lg">
          <input type="date" id="dateInput" name="date" value="{{ selected_date or '' }}"
            class="w-full h-11 px-4 py-2 rounded-md border border-gray-300 text-black dark:text-black cursor-pointer shadow-inner" />
          <div class="absolute inset-0 z-10" onclick="document.getElementById('dateInput').showPicker?.();"></div>
        </div>

        <!-- æ¤œç´¢ãƒœã‚¿ãƒ³ -->
        <button type="submit"
          class="w-32 h-11 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded dark:bg-emerald-500 dark:hover:bg-emerald-600 shadow-md transition">
          ğŸ” æ¤œç´¢
        </button>

        <!-- ã™ã¹ã¦è¡¨ç¤º -->
        <a href="{{ url_for('show_logs') }}"
          class="h-11 px-4 flex items-center bg-gray-100 text-gray-700 dark:bg-gray-200 dark:text-gray-800 rounded-md text-sm font-medium shadow-sm hover:bg-gray-300 transition">
          ã™ã¹ã¦è¡¨ç¤º
        </a>

      </div>
    </form>




    {% if grouped_logs %}
    {% for date, logs in grouped_logs.items() %}
    {% set safe_date = date.replace('-', '_') %}
    <section class="rounded-lg border border-slate-600 dark:border-gray-400 overflow-hidden">
      <!-- æ—¥ä»˜ã®è¦‹å‡ºã— -->
      <button onclick="toggleLogs('{{ date }}')"
        class="w-full text-left px-4 py-2 bg-slate-700 dark:bg-gray-300 dark:text-gray-900 text-white font-semibold hover:bg-slate-600 flex items-center gap-2">
        <!-- ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¢ã‚¤ã‚³ãƒ³ -->
        <img src="{{ url_for('static', filename='images/icon/LogLogNG.png') }}" alt="æ—¥ä»˜ï¼ˆãƒ©ã‚¤ãƒˆï¼‰"
          class="w-5 h-5 block dark:hidden" />

        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¢ã‚¤ã‚³ãƒ³ -->
        <img src="{{ url_for('static', filename='images/icon/LogLogNM.png') }}" alt="æ—¥ä»˜ï¼ˆãƒ€ãƒ¼ã‚¯ï¼‰"
          class="w-5 h-5 hidden dark:block" />

        {{ date }}
      </button>

      <!-- ãƒ­ã‚°ä¸€è¦§ -->
      <div id="logs-{{ safe_date }}" class="hidden px-6 py-4 space-y-4 bg-slate-800 dark:bg-gray-100">
        {% for log in logs %}
        <div
          class="p-4 rounded-lg shadow relative
                        {{ 'bg-blue-600 text-white' if log.role == 'user' else 'bg-emerald-600 text-white' }}
                        dark:{{ 'bg-blue-300 text-gray-900' if log.role == 'user' else 'bg-emerald-300 text-gray-900' }}">
          <div class="mb-2">
            <strong class="block text-sm">
              {{ current_user.username if log.role == 'user' else 'Iâ™¡RECO' }}ï¼ˆ{{ log.timestamp.strftime('%H:%M') }}ï¼‰
            </strong>
          </div>
          <div class="text-sm leading-relaxed">
            {{ log.message.replace('\n', '<br>') | safe }}
          </div>

          <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
          <form method="POST" action="{{ url_for('delete_log', log_id=log.id) }}"
            onsubmit="return confirm('ã“ã®ãƒ­ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');" class="absolute top-2 right-2">
            <button type="submit" class="text-xs bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded shadow">
              ğŸ—‘ï¸
            </button>
          </form>
        </div>
        {% endfor %}
      </div>
    </section>
    {% endfor %}
    {% else %}
    <p class="text-center text-slate-400 dark:text-gray-600 mt-6">
      ã¾ã ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
    </p>
    {% endif %}
  </main>

  <footer
    class="text-center text-sm text-slate-400 dark:text-gray-600 mt-8 mb-4 p-4 border-t border-slate-700 dark:border-gray-300">
    &copy; Iâ™¡RECO 2025 K2SI
  </footer>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>